<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>降水查询</title>
 <script language="javascript" type="text/javascript" src="../../js/jquery-1.12.0.min.js"></script>
 <script language="javascript" type="text/javascript" src="../../js/common.js"></script>
<!-- 引入97timepicker -->
 <script language="javascript" type="text/javascript" src="../../97timepicker/WdatePicker.js"></script>
 <link rel="stylesheet" href="../../css/temperature.css" type="text/css" media="screen"/>
 <link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen"/>
 <!-- 引入datatable -->
<link rel="stylesheet" href="../../datatable/css/jquery.dataTables.min.css" type="text/css" media="screen"/>
 <script language="javascript" type="text/javascript" src="../../datatable/js/jquery.dataTables.min.js"></script>
<!-- 引入weathermap -->
 <script type="text/javascript" src='../../weathermap/libs/WeatherMap.Include.js'></script>
 <script type="text/javascript" src='../../weathermap/libs/LocalTiledCacheLayer.js'></script>
 <script type="text/javascript" src='../../weathermap/libs/rain24hStyles.js'></script>
 <script type="text/javascript" src='../../weathermap/libs/FeatureUtilityClass.js'></script>
 <script type="text/javascript" src='../../weathermap/libs/TextDataClass.js'></script>
  <script type="text/javascript" src='../../weathermap/libs/Contour.js'></script>
  <script type="text/javascript" src='../../weathermap/libs/Plot.js'></script>
  
 <!-- 引入highcharts -->
 <script type="text/javascript" src='../../highcharts/highcharts.js'></script>
 <script type="text/javascript" src="../../highcharts/modules/exporting.js"></script>
 <link rel="stylesheet" href="../../css/bootstrap.min.css"/>
 <!-- 区域选择相关 -->
  <link rel="stylesheet" href="../../css/area.css"/>
   <script language="javascript" type="text/javascript" src="../../js/area.js"></script>
  <script type="text/javascript">
            //var host = document.location.toString().match(/file:\/\//)?"http://localhost:8090":'http://' + document.location.host;
            var map, layerWorld,baseLayer,featureLayers;
            
            
			function init(){
				var navigatnion = new WeatherMap.Control.Navigation();
		        map = new WeatherMap.Map("map",{controls:[
		            navigatnion, new WeatherMap.Control.Zoom()],projection: "EPSG:4326"});
		        //corePage.map.addControl(new WeatherMap.Control.MousePosition());
		        //本地缓存地图
		        baseLayer = new WeatherMap.Layer.LocalTiledCacheLayer();
		        map.addLayers([baseLayer]);
		        map.setCenter(new WeatherMap.LonLat(108.3, 97.26), 1);
		        map.zoomToScale(1/147914678, true);
		        initIsoRegionData(map);
                
			}
			
			// 初始化地图温度色斑图数据
			function initIsoRegionData(map){
			  var textDataClass = new TextDataClass();
			  textDataClass.addLayer(map);
			  textDataClass.addIsoSurface(null, map,"rain_24h");
			
			}
			
	         
			
			</script>

</head>
<body onload="init()">

   
  <div id="searchArea" class="searchArea">
  
   
  
	 <div id="yaosu" style="float:left;">   
	    要素:</br>
	      <div id="element" style="margin-left:30px;margin-top:10px;"> 
		       <div id="avg" class="e" style="float:left;margin-left:5px;cursor:pointer;">平均降水</div><div class="e" style="float:left;margin-left:5px;cursor:pointer;">累计降水</div></br>
	      </div></br>
	      <div style="margin-left:30px;margin-top:40px;"> 
	                    选择地区:<input type="text" name="my-name" id="my-name" value="请选择地区" onclick="pop()" />  
             <input type="hidden" name="my-value" id="my-value" />  
	              <div id="choose-box-wrapper">  
				      <div id="choose-box">  
				        <div id="choose-box-title">  
				            <span>选择地区</span>  
				        </div>  
				        <div id="choose-a-class">  
				        </div>  
				        <div>  
				            <ul id="choose-a-item">  
				            </ul>  
				        </div>  
				        <div id="choose-box-bottom">  
				            <input type="button" onclick="doSelect()" value="确定" />    
				            <input type="button" onclick="hide()" value="关闭" />  
				        </div>  
				      </div>  
				    </div>  
	      </div>
	  </div>
	  <div id="shiduan" style="float:left;margin-top:50px;">
	     时段:</br>
	       <div id="time" style="margin-left:30px;margin-top:10px;">
	          <div id="today">今日:<span>2016年03月04日</span></div></br>
	          <div>开始:<input id="dataStart" type="text" onClick="WdatePicker()"/></div></br>  
	          <div>结束:<input onblur="validate(this);"   id="dataEnd" type="text" onClick="WdatePicker()"/></div></br>    
	          <!--           
	          <div>
	             <div><button id="addYear" class="btn btn-default">+&nbsp;年</button><button class="btn btn-default" style="margin-left:10px;">-&nbsp;年</button><button class="btn btn-default" style="margin-left:10px;">+&nbsp;月</button><button class="btn btn-default" style="margin-left:10px;">-&nbsp;月</button></div>
	          </div>
	       -->
	       </div>
	  
	  </div>    
	  
	  <div id="duibi" style="float:left;margin-top:50px;">
	     对比:</br>
	    <div id="compare" style="margin-left:30px;margin-top:10px;">
	     <div id="myavg" class="duibi" style="float:left;">多年均值</div></br>
	     <div style="margin-top:20px;"><input type="number" style="width:80px;" value="1981">至<input type="number" style="width:80px;" value="2016"></div>
	    
	    </div>
	  </div>
	  
	  <div style="float:left;margin-left:50px;margin-top:100px;">
	     <a id="submit" href ="javascript:return false;" class='btn btn-primary' href='javascript:;'>查询</a>
	     
	  </div>
  </div>   
  
   
  
  <div id="mainContent" class="mainContent">
   <div id="centerContent" style="height:350px;">
	   <div  id="grid" style="float:left;width:500px;height:450px;overflow:auto;"> 
			<table id="example" class="display" cellspacing="0" width="100%">
		        <thead>
		            <tr>
		                <th>站号</th>
		                <th>站点名称</th>
		                <th>降水</th>
		                <th>距平</th>
		                
		            </tr>
		        </thead>
		        
         </table>
	   
	   </div>
	   
	   <div id="map" style="float:left;width:680px;height:432px;">
	   </div>
   </div>
   <div> 
     <div id="container" style="min-width:500px;height:250px"></div>
     
   </div>
  </div>
  
  
  
  
  
 
    <script type="text/javascript">
    
    
    
    function validate(obj){
        if($(obj).val()!=""){
           $("#submit").removeClass("disabled");
        }
    
    }
    
    
    
    $(document).ready(function () {

    
       //默认查询按钮为不可用状态
        $("#submit").addClass("disabled");
    
       
    	
    	//默认选定平均温度为条件
    	$("#avg").addClass("elementSelect");
    	$("#myavg").addClass("elementSelect");
    	$(".e").bind("click",function(){
        $(".e").removeClass("elementSelect");
    	$(this).addClass("elementSelect");
    	});
    	});
    	
    	
    	//选择极端气温判断时段
    	$(".jiduan").bind("click",function(){
    	   var dateStart = $("#dataStart").val();
    	   var dateEnd = $("#dataEnd").val();
    	   if(dateEnd == ""){
    	      alert("请选择结束时段");
    	   }
    	});
    	
    
         //初始化表格
          $('#example').DataTable({
                "paging":   false,
                "language":{
                    "sProcessing":"处理中...",
                    "sLengthMenu":"显示_MENU_项结果",
                    "sZeroRecords":"没有匹配结果",
                    "sInfo":"显示第_START_至_END_项结果，共_TOTAL_项",
                    "sInfoEmpty":"显示第0至0项结果，共0项",
                    "sInfoFiltered":"(由_MAX_项结果过滤)",
                    "sInfoPostFix":"","sSearch":"搜索:",
                    "sUrl":"","sEmptyTable":"表中数据为空",
                    "sInfoThousands":",",
                    "oPaginate":{
                          "sFirst":"首页",
                          "sPrevious":"上页",
                          "sNext":"下页",
                          "sLast":"末页"
                          },
                   "oAria":{
                         "sSortAscending":":以升序排列此列",
                         "sSortDescending":":以降序排列此列"
                         }
                    
                    },
		        "processing": true,
		        "serverSide": false,
		        "ajax": {
		            "url": "http://127.0.0.1:8080/EFS/rain/getRainAvgData",
		            "type": "POST"
		        },
		        "columns": [
		            { "data": "stationNum" },
		            { "data": "stationName" },
		            { "data": "rain_avg" },
		            { "data": "rain_anomaly" }
		            ],
		         "ordering": true,
		         "info": true,
		         "pagingType":   "simple_numbers"
          });
    
    
    

        // 初始化任意时段温度序列图
        
        $.ajax({
		    url: "http://127.0.0.1:8080/EFS/rain/initRainColumnarData",    
		    dataType: "json",   //返回格式为json
		    async: false, //请求是否异步，默认为异步，这也是ajax重要特性
		    type: "post",   //请求方式
		    success: function(data) {
		       debugger;
		       var dataString = eval(data);
		       //alert(dataString);
		       initTemChart(data);
		    },
		    error: function() {
		        //请求出错处理
		    }
		});

        
        function initTemChart(data){
        
		    $('#container').highcharts({
		        chart: {
		            zoomType: 'x',
		            spacingRight: 20
		        },
		        title: {
		            text: ''
		        },
		        subtitle: {
		            text: document.ontouchstart === undefined ?
		                '点击并拖拽放大数值区域' :
		                'Pinch the chart to zoom in'
		        },
		        xAxis: {
		            type: 'datetime',
		            maxZoom: 14 * 24 * 3600000, // fourteen days
		            title: {
		                text: null
		            }
		        },
		        yAxis: {
		            title: {
		                text: '降水(mm)'
		            }
		        },
		        tooltip: {
		            shared: true
		        },
		        legend: {
		            enabled: false
		        },
		        plotOptions: {
		            area: {
		                fillColor: {
		                    linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1},
		                    stops: [
		                        [0, Highcharts.getOptions().colors[0]],
		                        [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
		                    ]
		                },
		                lineWidth: 1,
		                marker: {
		                    enabled: false
		                },
		                shadow: false,
		                states: {
		                    hover: {
		                        lineWidth: 1
		                    }
		                },
		                threshold: null
		            }
		        },
		
		        series: [{
		            type: 'area',
		            name: 'USD to EUR',
		            pointInterval: 24 * 3600 * 1000,
		            pointStart: Date.UTC(2016, 0, 01),
		            data: data
		        }]
		    });
       		
        }
    </script>
    
      <script language="javascript" type="text/javascript" src="../../js/location.js"></script>
</body>
</html>